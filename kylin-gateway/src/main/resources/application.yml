spring:
  application:
    name: kylin-gateway
  jmx:
    enabled: false
  cloud:
    gateway:
      loadbalancer:
        use404: false
        queryRouteDefault: ${kylin.gateway.route.query-route-default}
      httpclient:
        connectTimeout: 15000
        responseTimeout: 480000
  datasource:
    driver-class-name: ${kylin.gateway.datasource.driver-class-name}
    url: ${kylin.gateway.datasource.url}
    username: ${kylin.gateway.datasource.username}
    password: ${kylin.gateway.datasource.password}
    hikari:
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      maximum-pool-size: 10
      minimum-idle: 1
      connection-test-query: select 1

logging:
  level:
    org.springframework.cloud.gateway: TRACE
    org.springframework.http.server.reactive: DEBUG
    org.springframework.web.reactive: DEBUG
    reactor.ipc.netty: DEBUG
    reactor.netty: DEBUG

server:
  error:
    include-message: always
    include-exception: true
  tomcat:
    basedir: ./
    accesslog:
      enabled: true
      buffered: true
      directory: logs
      file-date-format: .yyyy-MM-dd
      pattern: "%h %l %u %t \"%r\" %s %b %D %{User-Agent}i"
      rotate: true
      rename-on-rotate: false
      prefix: access_log
      suffix: .log

kylin:
  gateway:
    route:
      refresh-cron: 0/3 * * * * *
      query-route-default: true
      refresh-interval: 3s
    ke:
      version: 4x
      authentication-url: /kylin/api/user/authentication
      global-routing-urls: /kylin/api/projects/default_configs,/kylin/api/models/check_partition_desc
    rest-template:
      connect-timeout: 2000
      read-timeout: 5000
      pool:
        max-total: 50
        max-per-route: 2
    username-cache:
      expire: 1800
      concurrency-level: 10
      maximum-size: 3000
    health:
      check-url: /kylin/api/health
      rest-template:
        connect-timeout: 1500
        read-timeout: 5000
      ping-strategy:
        retry-times: 3
        interval-seconds: 3
    datasource:
      type: file
      route-table-file-path: ${gateway.home}/conf/route_table
      driver-class-name: com.mysql.jdbc.Driver
      url: jdbc:mysql://10.3.1.17:3306/leotest
      username: root
      password: passw0rd
      table-name: km_route_table

management.endpoints.web.exposure.include: health, gateway

server.port: 7777